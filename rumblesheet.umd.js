!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Rumblesheet=t()}(this,(function(){"use strict";var e,t,i,s,l,n,o;!function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Spreadsheet="spreadsheet"}(e||(e={})),function(e){e.Center="center",e.Left="left",e.Right="right"}(t||(t={})),function(e){e.Arial="Arial, sans-serif",e.Georgia="Georgia, serif",e.CourierNew="'Courier New', monospace",e.Verdana="Verdana, sans-serif",e.TimesNewRoman="'Times New Roman', serif",e.Tahoma="Tahoma, sans-serif",e.Roboto="'Roboto', sans-serif",e.OpenSans="'Open Sans', sans-serif",e.Lato="'Lato', sans-serif",e.Montserrat="'Montserrat', sans-serif",e.Poppins="'Poppins', sans-serif",e.Inter="'Inter', sans-serif",e.Lobster="'Lobster', cursive"}(i||(i={})),function(e){e.Middle="middle",e.Top="top",e.Bottom="bottom",e.Start="start",e.End="end"}(s||(s={})),function(e){e.Wrap="wrap",e.Clip="clip"}(l||(l={})),function(e){e.Paste="paste",e.Cut="cut",e.Copy="copy",e.IncreaseFont="increaseFont",e.DecreaseFont="decreaseFont",e.Bold="bold",e.Italic="italic",e.Underline="underline",e.FillColor="fillColor",e.TextColor="textColor",e.AlignLeft="alignLeft",e.AlignCenter="alignCenter",e.AlignRight="alignRight",e.DecreaseIndent="decreaseIndent",e.IncreaseIndent="increaseIndent",e.FontSize="fontSize",e.FontFamily="fontFamily",e.TextBaselineTop="textBaselineTop",e.TextBaselineMiddle="textBaselineMiddle",e.TextBaselineBottom="textBaselineBottom",e.AddExcelRow="addExcelRow",e.AddExcelCol="addExcelCol",e.DeleteExcel="deleteExcel"}(n||(n={})),function(e){e.File="File",e.Home="Home",e.Graph="Graph",e.Operations="Operations",e.Format="Format"}(o||(o={}));const a="#000000",r="#000000",h=i.Arial,c=t.Left,d=s.Middle,u=l.Clip,m=14,v="#000000",p=i.Arial,g="#ffffff",C={textAlign:c,textBaseline:d,fontSize:m,fontFamily:h,color:v,textIndent:0,textWrapping:u},x="green",b=[8,9,10,11,12,13,50,14,16,18,20],w=Object.values(i),f=Object.values(o),E=[n.Bold,n.Italic,n.Underline],y=[n.AlignCenter,n.AlignLeft,n.AlignRight],S=[n.TextBaselineBottom,n.TextBaselineMiddle,n.TextBaselineTop],M=[n.IncreaseIndent,n.DecreaseIndent],R=[n.IncreaseFont,n.DecreaseFont,n.Copy,n.Paste,n.Cut],z=[n.AddExcelCol,n.AddExcelRow,n.DeleteExcel];class H{constructor(e,t){this.excelsHandler=e,this.ribbon=t,this.initializeElement(),this.attachEvents()}get currentSheetObjHelper(){var e;return null===(e=this.excelsHandler.currSheetObj)||void 0===e?void 0:e.instance.helper}initializeElement(){this.tabButtons=document.querySelectorAll(".rumblesheet .tablist-items"),this.toggleContentBtn=document.querySelector(".rumblesheet #toggle-content"),this.focusZone=document.querySelector(".rumblesheet .focus-zone"),this.featureMenuBtns=document.querySelectorAll(".rumblesheet .feature-menu"),this.scrollLeftBtn=document.querySelector(".rumblesheet .scroll-left"),this.scrollRightBtn=document.querySelector(".rumblesheet .scroll-right")}attachEvents(){this.attachRibbonEvents()}attachRibbonTabEvents(){this.tabButtons.forEach((e=>{e.addEventListener("click",(e=>this.ribbon.ribbonFunctions.toggleTabForTarget(e.target)))}))}attachRibbonExpandedEvents(){this.toggleContentBtn&&this.toggleContentBtn.addEventListener("click",(()=>this.ribbon.ribbonFunctions.toggleContentBtnFunc()))}attachRibbonMenuButtonEvents(){this.featureMenuBtns.forEach((e=>{e.addEventListener("click",(e=>this.ribbon.ribbonFunctions.handleFeatureMenuToggle(e)))}))}attachRibbonScrollButtonEvents(){this.scrollLeftBtn&&this.scrollRightBtn&&(this.scrollLeftBtn.addEventListener("click",(e=>this.ribbon.ribbonFunctions.handleScrollRibbon(e))),this.scrollRightBtn.addEventListener("click",(e=>this.ribbon.ribbonFunctions.handleScrollRibbon(e))))}attachRibbonFeatureSelectEvents(){document.querySelectorAll(".ribbon .select-options").forEach((e=>{const t=e;t&&t.addEventListener("change",(()=>{this.handleSelectChange(t)}))}))}attachRibbonFeatureColorEvents(){document.querySelectorAll("input[type='color']").forEach((e=>{const t=e;t&&t.addEventListener("input",(()=>{this.handleColorElement(t)}))}))}attachRibbonFeatureButtonEvents(){if(!this.focusZone)return;const e='.feature-box .feature-icon[role="button"], .feature-box .feature-horizontal[role="button"], .feature-box .feature-vertical[role="button"]';this.focusZone.addEventListener("click",(t=>{const i=t.target.closest(e);i&&this.performRibbonAction(i)})),this.focusZone.addEventListener("keydown",(t=>{const i=t.target.closest(e);!i||"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.performRibbonAction(i))}))}attachRibbonFeatureEvents(){this.attachRibbonFeatureSelectEvents(),this.attachRibbonFeatureColorEvents(),this.attachRibbonFeatureButtonEvents()}attachRibbonEvents(){this.attachRibbonTabEvents(),this.attachRibbonExpandedEvents(),this.attachRibbonMenuButtonEvents(),this.attachRibbonScrollButtonEvents(),this.attachRibbonFeatureEvents()}handleExcelHandlerButtons(e){const t=this.excelsHandler.currExcelRow,i=this.excelsHandler.currExcelCol;switch(console.log(i,t),e){case n.AddExcelCol:t&&this.excelsHandler.addNewExcelCol(t);break;case n.AddExcelRow:this.excelsHandler.addNewExcelRow();break;case n.DeleteExcel:i&&t&&this.excelsHandler.deleteExcel(t,i)}}performRibbonAction(e){if(!e)return;const t=e.dataset.action;if(E.includes(t)){e.classList.toggle("active");const i=e.classList.contains("active");this.updateCellFormatting(t,i)}else y.includes(t)?(this.handleGroupRibbonActions(y,e),this.updateCellFormatting(t,!0)):S.includes(t)?(this.handleGroupRibbonActions(S,e),this.updateCellFormatting(t,!0)):M.includes(t)?(this.handleGroupRibbonActions(M,e),this.updateCellFormatting(t,!0)):R.includes(t)?this.updateCellFormatting(t,!0):z.includes(t)?this.handleExcelHandlerButtons(t):console.log("Unhandled Case")}handleGroupRibbonActions(e,t){e.forEach((e=>{const t=document.querySelector(`[data-action="${e}"]`);t&&t.classList.remove("active")})),t.classList.add("active")}updateCellFormatting(e,i,l=""){var o,a;const r=null===(o=this.currentSheetObjHelper)||void 0===o?void 0:o.mainCellManager.getCurrSelectedCells();r&&r.forEach((o=>{var a,r,h,c,d,u,v,p,g;if(o&&!o.cell){const e=null===(a=o.row)||void 0===a?void 0:a.row,t=null===(r=o.column)||void 0===r?void 0:r.col;e&&t&&(null===(h=this.currentSheetObjHelper)||void 0===h||h.setCell(e,t,""),o.cell=null!==(d=null===(c=this.currentSheetObjHelper)||void 0===c?void 0:c.getCell(e,t))&&void 0!==d?d:null)}if(o&&o.cell)switch(e){case n.Bold:o.cell.styles.bold=i;break;case n.Italic:o.cell.styles.italic=i;break;case n.Underline:o.cell.styles.underline=i;break;case n.AlignLeft:o.cell.styles.textAlign=t.Left;break;case n.AlignRight:o.cell.styles.textAlign=t.Right;break;case n.AlignCenter:o.cell.styles.textAlign=t.Center;break;case n.IncreaseFont:o.cell.styles.fontSize=(null!==(u=o.cell.styles.fontSize)&&void 0!==u?u:m)+1;break;case n.DecreaseFont:o.cell.styles.fontSize=(null!==(v=o.cell.styles.fontSize)&&void 0!==v?v:m)-1;break;case n.TextBaselineTop:o.cell.styles.textBaseline=s.Start;break;case n.TextBaselineMiddle:o.cell.styles.textBaseline=s.Middle;break;case n.TextBaselineBottom:o.cell.styles.textBaseline=s.End;break;case n.Cut:case n.Copy:case n.Paste:break;case n.FontFamily:o.cell.styles.fontFamily=l;break;case n.FontSize:o.cell.styles.fontSize=parseInt(l);break;case n.FillColor:o.cell.styles.fill=l;break;case n.TextColor:o.cell.styles.color=l;break;case n.IncreaseIndent:o.cell.styles.textIndent=(null!==(p=o.cell.styles.textIndent)&&void 0!==p?p:0)+4;break;case n.DecreaseIndent:o.cell.styles.textIndent=Math.max(0,(null!==(g=o.cell.styles.textIndent)&&void 0!==g?g:0)-4)}})),null===(a=this.currentSheetObjHelper)||void 0===a||a.updateDrawForFeatures()}handleSelectChange(e){const t=e,i=t.dataset.action;t&&t.value&&i&&this.updateCellFormatting(i,!0,t.value)}handleColorElement(e){const t=e,i=t.dataset.action;t&&t.value&&i&&this.updateCellFormatting(i,!0,t.value)}}class T{constructor(e,t,i,s,l,n,o,a){this.rowValue=e,this.colValue=t,this.value=i,this.nextRow=s,this.nextCol=l,this.prevRow=n,this.prevCol=o,this.styles=Object.assign(Object.assign({},C),a)}}class I{constructor(){this.rowHeaders={},this.colHeaders={}}_cellExists(e,t){let i=this.rowHeaders[e];for(;i;){if(i.colValue===t)return!0;i=i.nextCol}return!1}_shiftRow(e,t){let i=this.rowHeaders[e];for(;i;)i.rowValue=t,i=i.nextCol;this.rowHeaders[t]=this.rowHeaders[e],delete this.rowHeaders[e]}_shiftColumn(e,t){let i=this.colHeaders[e];for(;i;)i.colValue=t,i=i.nextRow;this.colHeaders[t]=this.colHeaders[e],delete this.colHeaders[e]}_insertCellInRow(e,t){let i,s=this.rowHeaders[e];for(;s&&s.colValue<t.colValue;)i=s,s=s.nextCol;i?(i.nextCol=t,t.prevCol=i):this.rowHeaders[e]=t,s&&(t.nextCol=s,s.prevCol=t)}_insertCellInColumn(e,t){let i,s=this.colHeaders[e];for(;s&&s.rowValue<t.rowValue;)i=s,s=s.nextRow;i?(i.nextRow=t,t.prevRow=i):this.colHeaders[e]=t,s&&(t.nextRow=s,s.prevRow=t)}_shiftCellsRight(e,t){let i=this.rowHeaders[e];for(;i&&i.colValue<t;)i=i.nextCol;for(;i;)this._shiftColumn(i.colValue,i.colValue+1),i=i.nextCol}_shiftCellsDown(e,t){let i=this.colHeaders[t];for(;i&&i.rowValue<e;)i=i.nextRow;for(;i;)this._shiftRow(i.rowValue,i.rowValue+1),i=i.nextRow}_removeCellFromRow(e,t){let i,s=this.rowHeaders[e];for(;s&&s.colValue!==t;)i=s,s=s.nextCol;s&&(i?i.nextCol=s.nextCol:this.rowHeaders[e]=s.nextCol,s.nextCol&&(s.nextCol.prevCol=i))}_removeCellFromColumn(e,t){let i,s=this.colHeaders[t];for(;s&&s.rowValue!==e;)i=s,s=s.nextRow;s&&(i?i.nextRow=s.nextRow:this.colHeaders[t]=s.nextRow,s.nextRow&&(s.nextRow.prevRow=i))}createCell(e,t,i){if(this._cellExists(e,t))return;const s=new T(e,t,i);this.rowHeaders[e]?this._insertCellInRow(e,s):this.rowHeaders[e]=s,this.colHeaders[t]?this._insertCellInColumn(t,s):this.colHeaders[t]=s}_updateCellValue(e,t,i){let s=this.rowHeaders[e];for(;s;){if(s.colValue===t)return void(s.value=i);s=s.nextCol}}addRowInBetween(e){Object.keys(this.rowHeaders).map(Number).sort(((e,t)=>t-e)).forEach((t=>{t>=e&&this._shiftRow(t,t+1)}));for(let t in this.colHeaders){const i=new T(e,parseInt(t),null);this._insertCellInColumn(parseInt(t),i)}}addColumnInBetween(e){Object.keys(this.colHeaders).map(Number).sort(((e,t)=>t-e)).forEach((t=>{t>=e&&this._shiftColumn(t,t+1)}));for(let t in this.rowHeaders){const i=new T(parseInt(t),e,null);this._insertCellInRow(parseInt(t),i),this._insertCellInColumn(e,i)}}deleteRow(e){let t=this.rowHeaders[e];for(;t;)this._removeCellFromColumn(t.colValue,e),t=t.nextCol;delete this.rowHeaders[e],Object.keys(this.rowHeaders).map(Number).sort(((e,t)=>e-t)).forEach((t=>{t>e&&this._shiftRow(t,t-1)}))}deleteColumn(e){let t=this.colHeaders[e];for(;t;)this._removeCellFromRow(t.rowValue,e),t=t.nextRow;delete this.colHeaders[e],Object.keys(this.colHeaders).map(Number).sort(((e,t)=>e-t)).forEach((t=>{t>e&&this._shiftColumn(t,t-1)}))}getCell(e,t){let i=this.rowHeaders[e];for(console.log(e,t,i);i;){if(i.colValue===t)return console.log("returning the current value",i),i;i=i.nextCol}return console.log("returning null"),null}setCell(e,t,i){this._cellExists(e,t)?this._updateCellValue(e,t,i):this.createCell(e,t,i)}updateCellsForSparse(e){var t,i,s,l,n,o;if(!e.length)return;for(const n of e){const o=null===(t=n.column)||void 0===t?void 0:t.col,a=null===(i=n.row)||void 0===i?void 0:i.row;if(void 0===o||void 0===a)continue;this._cellExists(a,o)||this.createCell(a,o,null);const r=this.getCell(a,o);r&&(r.mergedTo=this.getCell(null===(s=e[0].row)||void 0===s?void 0:s.row,null===(l=e[0].column)||void 0===l?void 0:l.col),console.log(r))}const a=this.getCell(null===(n=e[0].row)||void 0===n?void 0:n.row,null===(o=e[0].column)||void 0===o?void 0:o.col);a.firstRowHeaderCell=e[0].row,a.firstColumnHeaderCell=e[0].column,a.lastRowHeaderCell=e[e.length-1].row,a.lastColumnHeaderCell=e[e.length-1].column}}class ${constructor(e){this.headerCellManager=e,this.resizeThreshold=5,this.isResizing=!1,this.resizeStart=null,this.resizeType=null,this.resizeIndex=null,this.currentResizePosition=null,this.canvases=this.headerCellManager.getCanvases(),this.setupEventListeners()}setupEventListeners(){const e=this.canvases.horizontal,t=this.canvases.vertical;e.addEventListener("mousedown",this.handleMouseDown.bind(this,"horizontal")),t.addEventListener("mousedown",this.handleMouseDown.bind(this,"vertical")),e.addEventListener("mousemove",this.handleMouseMove.bind(this)),t.addEventListener("mousemove",this.handleMouseMove.bind(this)),window.addEventListener("mouseup",this.handleMouseUp.bind(this)),window.addEventListener("mousemove",this.handleDrag.bind(this))}handleMouseMove(e){if(this.isResizing)return;const t=e.target,i=t.getBoundingClientRect(),s=e.clientX-i.left,l=e.clientY-i.top,n=t===this.canvases.horizontal,o=n?this.headerCellManager.getScroll().x:this.headerCellManager.getScroll().y,a=n?this.headerCellManager.getHorizontalHeaderCells(o):this.headerCellManager.getVerticalHeaderCells(o),r=this.getResizeEdge(a,s+o,l+o,n);t.style.cursor=r?n?"col-resize":"row-resize":"default"}handleMouseDown(e,t){const i=t.target.getBoundingClientRect(),s=t.clientX-i.left,l=t.clientY-i.top,n="horizontal"===e,o=n?this.headerCellManager.getScroll().x:this.headerCellManager.getScroll().y,a=n?this.headerCellManager.getHorizontalHeaderCells(o):this.headerCellManager.getVerticalHeaderCells(o),r=this.getResizeEdge(a,s+o,l+o,n);return!!r&&(this.isResizing=!0,this.resizeStart=n?s+o:l+o,this.resizeType=n?"column":"row","column"===this.resizeType?this.resizeIndex=a[r.index].col-1:this.resizeIndex=a[r.index].row-1,t.preventDefault(),!0)}handleDrag(e){if(!this.isResizing)return;const t=("column"===this.resizeType?this.canvases.horizontal:this.canvases.vertical).getBoundingClientRect(),i="column"===this.resizeType?this.headerCellManager.getScroll().x:this.headerCellManager.getScroll().y,s="column"===this.resizeType?e.clientX-t.left+i:e.clientY-t.top+i;this.currentResizePosition=s,this.headerCellManager.draw(),this.drawResizeGuide()}handleMouseUp(e){this.isResizing&&(this.applyResize(e),this.isResizing=!1)}applyResize(e){if(!this.isResizing||!this.resizeType||null===this.resizeIndex)return;const t=("column"===this.resizeType?this.canvases.horizontal:this.canvases.vertical).getBoundingClientRect(),i="column"===this.resizeType?this.headerCellManager.getScroll().x:this.headerCellManager.getScroll().y,s=("column"===this.resizeType?e.clientX-t.left+i:e.clientY-t.top+i)-(this.resizeStart||0),l=this.headerCellManager,n=l.getCellSize("column"===this.resizeType?"horizontal":"vertical",this.resizeIndex),o=Math.max(20,n+s);l.setCustomCellSize("column"===this.resizeType?"horizontal":"vertical",this.resizeIndex,o),this.isResizing=!1,this.currentResizePosition=null,this.headerCellManager.draw()}getResizeEdge(e,t,i,s){for(let l=0;l<e.length;l++){const n=e[l],o=s?n.x+n.width:n.y+n.height;if(Math.abs(o-(s?t:i))<=this.resizeThreshold)return{index:l,position:o}}return null}drawResizeGuide(){if(!this.isResizing||null===this.currentResizePosition)return;const e=this.canvases.horizontal.getContext("2d"),t=this.canvases.vertical.getContext("2d"),i=this.canvases.spreadsheet.getContext("2d"),s=this.headerCellManager.getScroll().x,l=this.headerCellManager.getScroll().y,n=e=>{e.strokeStyle="#4285f4",e.lineWidth=2,e.setLineDash([5,3])};if("column"===this.resizeType){const t=this.currentResizePosition-s;n(e),e.moveTo(t,0),e.beginPath(),e.lineTo(t,this.canvases.horizontal.height),e.stroke(),n(i),i.beginPath(),i.moveTo(t,0),i.lineTo(t,this.canvases.spreadsheet.height),i.stroke()}else if("row"===this.resizeType){const e=this.currentResizePosition-l;n(t),t.beginPath(),t.moveTo(0,e),t.lineTo(this.canvases.vertical.width,e),t.stroke(),n(i),i.beginPath(),i.moveTo(0,e),i.lineTo(this.canvases.spreadsheet.width,e),i.stroke()}e.setLineDash([]),t.setLineDash([]),i.setLineDash([])}isResizingActive(){return this.isResizing}removeEventListeners(){const e=this.canvases.horizontal,t=this.canvases.vertical;e.removeEventListener("mousemove",this.handleMouseMove),t.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mouseup",this.handleMouseUp),window.removeEventListener("mousemove",this.handleDrag)}}class L{constructor(e){this.helper=e,this.canvases=this.helper.getCanvases(),this.initiateFeature(),this.setupInputEventListener()}setCustomCellSize(e,t,i){this.helper.setCustomCellSize(e,t,i)}getCellSize(e,t){var i;return null===(i=this.helper)||void 0===i?void 0:i.getCellSize(e,t)}updateCellPositions(e){const t="horizontal"===e?this.getHorizontalHeaderCells(0):this.getVerticalHeaderCells(0);let i=0;t.forEach(((t,s)=>{"horizontal"===e?(t.width=50,t.x=i,i+=t.width):(t.height=10,t.y=i,i+=t.height)}))}initiateFeature(){new $(this)}setupInputEventListener(){const{row:e,col:t,index:i}=this.helper.sheetMaker;document.getElementById(`input_${e}_${t}_${i}`)}handleKeyDown(e){e.key}getCanvases(){return this.canvases}getContexts(){return this.helper.getContexts()}getCanvasCoordinates(e){const t=this.canvases.spreadsheet.getBoundingClientRect(),i=e.clientX-t.left,s=e.clientY-t.top,{x:l,y:n}=this.helper.getScroll();return{x:i+l*this.helper.zoomIndex,y:s+n*this.helper.zoomIndex}}scroll(e,t){this.helper.setScroll(e,t)}getCellFromCoordinates(e,t){const i=this.helper.getHorizontalHeaderCells(e),s=this.helper.getVerticalHeaderCells(t),l=i.find((t=>e>=t.x&&e<t.x+t.width)),n=s.find((e=>t>=e.y&&t<e.y+e.height));return l&&n?{column:l,row:n}:null}getHorizontalHeaderCells(e){return this.helper.getHorizontalHeaderCells(e)}getVerticalHeaderCells(e){return this.helper.getVerticalHeaderCells(e)}getCellIndexFromPosition(e,t){const i="horizontal"===e?this.getHorizontalHeaderCells(this.getScroll().x):this.getVerticalHeaderCells(this.getScroll().y);for(let s=0;s<i.length;s++){const l=i[s],n="horizontal"===e?l.x:l.y,o="horizontal"===e?l.width:l.height;if(t>=n&&t<n+o)return"horizontal"===e?l.col:l.row}return null}getPositionFromIndex(e,t){const i="horizontal"===e?this.getHorizontalHeaderCells(this.getScroll().x):this.getVerticalHeaderCells(this.getScroll().y);for(let s=0;s<i.length;s++){const l=i[s];if("horizontal"===e&&l.col===t||"vertical"===e&&l.row===t)return"horizontal"===e?l.x:l.y}return 0}getCellsFromRect(e,t){const i=this.helper.getAllHorizontalHeaderCells(),s=this.helper.getAllVerticalHeaderCells(),l=Math.min(e.x,t.x),n=Math.max(e.x,t.x),o=Math.min(e.y,t.y),a=Math.max(e.y,t.y),r=this.helper.binarySearch(i,l,"x"),h=this.helper.binarySearch(i,n,"x"),c=this.helper.binarySearch(s,o,"y"),d=this.helper.binarySearch(s,a,"y"),u=[];for(let e=r;e<=h;e++)for(let t=c;t<=d;t++)u.push({column:i[e],row:s[t],cell:this.helper.getCell(s[t].row,i[e].col)});return u}updateInputElement(e){var t;this.input=document.getElementById(`input_${this.helper.sheetMaker.row}_${this.helper.sheetMaker.col}_${this.helper.sheetMaker.index}`),this.input.addEventListener("blur",(function(){this.style.display="none"}));const{x:i,y:s}=this.helper.getScroll(),l=this.helper.zoomIndex,n=this.helper.getCell(e.row.row,e.column.col),o=n&&null!==(t=n.styles.fontSize)&&void 0!==t?t:14;this.input.style.position="absolute",this.input.style.left=e.column.x-i+2+"px",this.input.style.top=e.row.y-s+2+"px",this.input.style.width=e.column.width-4+"px",this.input.style.height=e.row.height-4+"px",this.input.style.fontSize=o*l+"px",this.input.style.textAlign="center",this.input.style.display="block",this.input.focus();const a=n?n.value:"";this.input.value=null!==a?a:""}hideInputElement(){const e=document.getElementById(`input_${this.helper.sheetMaker.row}_${this.helper.sheetMaker.col}_${this.helper.sheetMaker.index}`);e&&(e.style.display="none")}getScroll(){return this.helper.getScroll()}draw(){this.helper.draw()}}class B{constructor(e){this.maincellManager=e,this.canvases=this.maincellManager.getCanvases(),this.selectedCells=[],this.isDragging=!1,this.isScrolling=!1,this.setupEventListeners()}setupEventListeners(){this.canvases.spreadsheet.addEventListener("pointerdown",(e=>{0===e.button&&this.handlePointerDown(e)})),document.addEventListener("pointerup",this.handlePointerUp.bind(this)),document.addEventListener("pointermove",this.handlePointerMove.bind(this))}handlePointerDown(e){e.preventDefault(),this.startPoint=this.maincellManager.getCanvasCoordinates(e),this.handleCellClick(e),this.isDragging||(this.selectedCells=[],this.isDragging=!0,this.isScrolling=!0,this.updateSelectedCells(this.startPoint))}handlePointerUp(){this.isScrolling=!1,this.removeEventListeners(),this.isDragging&&(this.isDragging=!1)}handlePointerMove(e){if(this.isDragging){const t=this.maincellManager.getCanvasCoordinates(e);this.updateSelectedCells(t),this.handleScrolling(e)}}handleScrolling(e){const{x:t,y:i}=this.maincellManager.getCanvasCoordinates(e),{x:s,y:l}=this.maincellManager.getScroll(),n=this.canvases.spreadsheet;t-s<0&&e.movementX<0?this.maincellManager.setScroll(-10,0):t-s>n.clientWidth-30&&e.movementX>0&&this.maincellManager.setScroll(10,0),i-l<0&&e.movementY<0?this.maincellManager.setScroll(0,-10):i-l>n.clientHeight-30&&e.movementY>0&&this.maincellManager.setScroll(0,10),this.maincellManager.updateInputElement(this.clickedCell_headercells)}handleCellClick(e){if(this.isDragging)return;const{x:t,y:i}=this.maincellManager.getCanvasCoordinates(e);this.clickedCell_headercells=this.maincellManager.getCellFromCoordinates(t,i),this.clickedCell_headercells&&(this.deselectCurrentCells(),this.selectCell(this.clickedCell_headercells))}selectCell(e){this.maincellManager.updateInputElement(e),this.maincellManager.draw()}deselectCurrentCells(){this.selectedCells.length>0&&(this.selectedCells=[],this.maincellManager.hideInputElement(),this.maincellManager.draw())}updateDrawForScrolling(){this.maincellManager.updateInputElement(this.clickedCell_headercells),this.selectCell(this.clickedCell_headercells),this.drawHighlight()}updateSelectedCells(e){const t=this.maincellManager.getCellsFromRect(this.startPoint,e);this.selectedCells=t,this.drawHighlight()}drawHighlight(){this.maincellManager.draw();const e=this.canvases.spreadsheet.getContext("2d"),{x:t,y:i}=this.maincellManager.getScroll();if(0===this.selectedCells.length)return;let s=1/0,l=-1/0,n=1/0,o=-1/0;e.strokeStyle="green",e.lineWidth=4;for(const e of this.selectedCells){const t=e.cell;(null==t?void 0:t.mergedTo)?(s=Math.min(s,t.mergedTo.firstColumnHeaderCell.x),n=Math.min(n,t.mergedTo.firstRowHeaderCell.y),l=Math.max(l,t.mergedTo.lastColumnHeaderCell.x+t.mergedTo.lastColumnHeaderCell.width),o=Math.max(o,t.mergedTo.lastRowHeaderCell.y+t.mergedTo.lastRowHeaderCell.height)):(s=Math.min(s,e.column.x),n=Math.min(n,e.row.y),l=Math.max(l,e.column.x+e.column.width),o=Math.max(o,e.row.y+e.row.height))}this.drawRectangleOnHeaderCanvas("horizontal",s-t,0,l-s,30,!0),this.drawRectangleOnHeaderCanvas("vertical",0,n-i,50,o-n,!1),e.fillStyle="rgb(131,242,143,0.6)",e.fillRect(s-t,n-i,l-s,o-n),e.strokeRect(s-t,n-i,l-s,o-n)}drawRectangleOnHeaderCanvas(e,t,i,s=0,l=0,n){const o=this.maincellManager.getContexts()[e];o.beginPath(),o.fillStyle="rgb(131,242,143,0.3)",o.fillRect(t,i,s,l),n?(o.strokeStyle=x,o.lineWidth=4,o.moveTo(t,20),o.lineTo(t+s,20)):(o.strokeStyle=x,o.lineWidth=4,o.moveTo(30,i),o.lineTo(30,i+l)),o.stroke()}removeEventListeners(){this.canvases.spreadsheet.removeEventListener("pointerdown",this.handlePointerDown),document.removeEventListener("pointerup",this.handlePointerUp),document.removeEventListener("pointermove",this.handlePointerMove)}}class k{constructor(e){this.maincellManager=e,this.canvases=this.maincellManager.getCanvases(),this.setupEventListeners()}setupEventListeners(){this.canvases.spreadsheet.addEventListener("contextmenu",this.handleRightClick.bind(this))}handleRightClick(e){e.preventDefault(),this.selectedCells=this.maincellManager.getCurrSelectedCells();const t=e.currentTarget.getBoundingClientRect();e.clientX,t.left,e.clientY,t.top,this.selectedCells.length&&this.showContextMenu(e.clientX,e.clientY)}showContextMenu(e,t){let i=document.getElementById("merge-context-menu");i&&i.remove();const s=document.createElement("div");s.id="merge-context-menu",s.innerText="Merge",s.style.position="fixed",s.style.left=`${e}px`,s.style.top=`${t}px`,s.style.background="#fff",s.style.border="1px solid #ccc",s.style.padding="8px 12px",s.style.cursor="pointer",s.style.zIndex="9999",s.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)",s.addEventListener("click",(()=>{this.mergeSelectedCells(),s.remove()})),document.body.appendChild(s);const l=()=>{s.remove(),document.removeEventListener("click",l)};setTimeout((()=>document.addEventListener("click",l)),0)}mergeSelectedCells(){this.selectedCells.length<=1||(this.maincellManager.updateCellsValueForMerging(),this.selectedCells=[])}}class A{constructor(e){this.helper=e,this.canvases=this.helper.getCanvases(),this.initiateFeature(),this.setupInputEventListener()}setupInputEventListener(){const{row:e,col:t,index:i}=this.helper.sheetMaker,s=document.getElementById(`input_${e}_${t}_${i}`);s?(s.addEventListener("input",(e=>{this.handleInputChange(e)})),s.addEventListener("keydown",(e=>{this.handleKeyDown(e)})),s.addEventListener("blur",(e=>{this.handleInputBlur(e)}))):console.error("Input element not found")}handleInputChange(e){const t=e.target;if(this.selectionCell.selectedCells){const e=t.innerText;this.updateCellValue(e)}else console.warn("No cell is currently selected.");if(t.scrollHeight>t.offsetHeight){let e=parseInt(t.style.width)||t.offsetWidth;t.style.width=`${e+120}px`}}handleKeyDown(e){e.key}handleInputBlur(e){this.updateCellValue(e.target.innerText)}updateCellValue(e){var t,i;if(this.selectionCell.selectedCells[0]){const{row:s,column:l}=this.selectionCell.selectedCells[0];let n=s.row,o=l.col;if(null===(t=this.selectionCell.selectedCells[0].cell)||void 0===t?void 0:t.mergedTo){const e=null===(i=this.selectionCell.selectedCells[0].cell)||void 0===i?void 0:i.mergedTo;n=e.rowValue,o=e.colValue}this.helper.setCell(n,o,e),this.selectionCell.selectedCells[0].cell=this.helper.getCell(n,o)}}updateCellsValueForMerging(){if(this.selectionCell.selectedCells[0]){const{row:e,column:t}=this.selectionCell.selectedCells[0];e.row,t.col,this.helper.updateCellsForSparse(this.selectionCell.selectedCells)}}initiateFeature(){this.selectionCell=new B(this),this.mergeCell=new k(this)}getCanvasCoordinates(e){const t=this.canvases.spreadsheet.getBoundingClientRect(),i=e.clientX-t.left,s=e.clientY-t.top,{x:l,y:n}=this.helper.getScroll();return{x:i+l*this.helper.zoomIndex,y:s+n*this.helper.zoomIndex}}setScroll(e,t){this.helper.setScroll(e,t)}getScroll(){return this.helper.getScroll()}draw(){this.helper.draw()}getCanvases(){return this.canvases}getContexts(){return this.helper.getContexts()}getCellFromCoordinates(e,t){var i,s;const l=this.helper.getHorizontalHeaderCells(e),n=this.helper.getVerticalHeaderCells(t),o=l.find((t=>e>=t.x&&e<t.x+t.width)),a=n.find((e=>t>=e.y&&t<e.y+e.height)),r=this.helper.getCell(null==a?void 0:a.row,null==o?void 0:o.col);if(r&&r.mergedTo){const e=r.mergedTo.rowValue,t=r.mergedTo.colValue,l=null===(i=this.helper.GridHeaderManager)||void 0===i?void 0:i.getAllHorizontalHeaderCells(),n=null===(s=this.helper.GridHeaderManager)||void 0===s?void 0:s.getAllVerticalHeaderCells(),h=null==l?void 0:l[t-1],c=null==n?void 0:n[e-1],d=this.helper.getCell(null==a?void 0:a.row,null==o?void 0:o.col);return h&&c?{column:h,row:c,cell:d}:null}return o&&a?{column:o,row:a,cell:r}:null}getCellsFromRect(e,t){const i=this.helper.getAllHorizontalHeaderCells(),s=this.helper.getAllVerticalHeaderCells(),l=Math.min(e.x,t.x),n=Math.max(e.x,t.x),o=Math.min(e.y,t.y),a=Math.max(e.y,t.y),r=this.helper.binarySearch(i,l,"x"),h=this.helper.binarySearch(i,n,"x"),c=this.helper.binarySearch(s,o,"y"),d=this.helper.binarySearch(s,a,"y");let u=[];for(let e=r;e<=h;e++)for(let t=c;t<=d;t++){const l=this.helper.getCell(s[t].row,i[e].col);console.log("About to push cell:",l);const n={column:i[e],row:s[t],cell:l};console.log("Created cell object:",n),u.push(n),console.log("After push, last item:",u[u.length-1])}return console.log(u),u}updateDrawForScrolling(){this.selectionCell.updateDrawForScrolling()}updateInputElementWithoutCell(){this.updateInputElement(this.selectionCell.clickedCell_headercells)}updateInputElement(e){var t,i,l,n;if(!e||!e.column||!e.row)return;this.input=document.getElementById(`input_${this.helper.sheetMaker.row}_${this.helper.sheetMaker.col}_${this.helper.sheetMaker.index}`);const{x:o,y:a}=this.getScroll(),r=this.helper.zoomIndex;let h,d,u,C,x=this.helper.getCell(e.row.row,e.column.col);const b=null!==(t=null==x?void 0:x.styles.fontSize)&&void 0!==t?t:m,w=null!==(i=null==x?void 0:x.styles.textAlign)&&void 0!==i?i:c;(null==x?void 0:x.mergedTo)&&(x=x.mergedTo,h=x.firstColumnHeaderCell.x-o+2+"px",d=x.firstRowHeaderCell.y-a+2+"px",u=x.lastColumnHeaderCell.x-x.firstColumnHeaderCell.x+x.lastColumnHeaderCell.width-4+"px",C=x.lastRowHeaderCell.y-x.firstRowHeaderCell.y+x.lastRowHeaderCell.height-4+"px");const f=(null==x?void 0:x.styles.textBaseline)===s.Middle?"center":(null==x?void 0:x.styles.textBaseline)||"center",E=(null==x?void 0:x.styles.bold)?"bold":"normal",y=(null==x?void 0:x.styles.italic)?"italic":"normal",S=(null==x?void 0:x.styles.color)?null==x?void 0:x.styles.color:v,M=(null==x?void 0:x.styles.fill)?x.styles.fill:g;Object.assign(this.input.style,{position:"absolute",left:h||e.column.x-o+2+"px",top:d||e.row.y-a+2+"px",width:u||e.column.width-4+"px",height:C||e.row.height-4+"px",fontSize:b*r+"px",fontFamily:`${null!==(l=null==x?void 0:x.styles.fontFamily)&&void 0!==l?l:p}`,textAlign:w,lineHeight:b*r+"px",alignContent:f,padding:"0px 7px",display:"block",fontWeight:E,fontStyle:y,color:S,backgroundColor:M}),this.input.innerText=null!==(n=null==x?void 0:x.value)&&void 0!==n?n:"",this.input.focus()}hideInputElement(){const e=document.getElementById(`input_${this.helper.sheetMaker.row}_${this.helper.sheetMaker.col}_${this.helper.sheetMaker.index}`);e&&(e.style.display="none")}getCurrSelectedCells(){return this.selectionCell.selectedCells}}class F{constructor(e,t,i,s,l,n,o){this.x=e,this.y=t,this.width=i,this.height=s,this.value=l,this.row=n,this.col=o}}class D{constructor(e,t,i,s,l,n){this.headerCellsHorizontal=[],this.headerCellsVertical=[],this.customColumnWidths=new Map,this.customRowHeights=new Map,this.initialLoadCount=20,this.loadIncrement=40,this.baseCellWidth=120,this.baseCellHeight=40,this.minimumCellWidHei=2,this.helper=e,this.viewportWidth=t,this.viewportHeight=i,this.minZoom=this.helper.minZoom,this.maxZoom=this.helper.maxZoom,this.zoomIndex=Math.min(Math.max(s,this.minZoom),this.maxZoom),this.isInfiniteRow=0===l,this.isInfiniteCol=0===n,this.totalRow=this.isInfiniteRow?Number.MAX_SAFE_INTEGER:l,this.totalCol=this.isInfiniteCol?Number.MAX_SAFE_INTEGER:n,this.helper.loadedRows=Math.min(this.initialLoadCount,this.isInfiniteRow?1/0:l),this.helper.loadedCols=Math.min(this.initialLoadCount,this.isInfiniteCol?1/0:n),this.update(t,i,this.zoomIndex)}update(e,t,i){const s=this.zoomIndex;this.viewportWidth=e,this.viewportHeight=t,this.zoomIndex=i,this.resizeAllCells(s,i),this.generateNewCells()}generateNewCells(){const e=Math.max(this.minimumCellWidHei,this.baseCellWidth*this.zoomIndex),t=Math.max(this.minimumCellWidHei,this.baseCellHeight*this.zoomIndex);this._updateHeaderCells("horizontal",e),this._updateHeaderCells("vertical",t)}_updateHeaderCells(e,t){const i="horizontal"===e,s=Math.min(Math.ceil(i?this.helper.loadedCols:this.helper.loadedRows),i?this.totalCol:this.totalRow),l=i?this.headerCellsHorizontal:this.headerCellsVertical;for(;l.length<s;){const e=l.length,s=(i?this.customColumnWidths.get(e):this.customRowHeights.get(e))||t,n=new F(0,0,i?s:this.minimumCellWidHei,i?this.minimumCellWidHei:s,i?this.helper.numberToColumnName(e+1):e+1,i?0:e+1,i?e+1:0);l.push(n)}this.updateCellPositions(e)}updateCellPositions(e){const t="horizontal"===e?this.headerCellsHorizontal:this.headerCellsVertical;let i=0;t.forEach(((t,s)=>{"horizontal"===e?(t.width=this.customColumnWidths.get(s)||t.width,t.x=i,i+=t.width):(t.height=this.customRowHeights.get(s)||t.height,t.y=i,i+=t.height)}))}calculateVisibleCells(){const e=this.baseCellWidth*this.zoomIndex,t=this.baseCellHeight*this.zoomIndex;return{rows:Math.ceil(this.viewportHeight/t),cols:Math.ceil(this.viewportWidth/e)}}getCellSize(e,t){return"horizontal"===e?this.customColumnWidths.get(t)||this.baseCellWidth*this.zoomIndex:this.customRowHeights.get(t)||this.baseCellHeight*this.zoomIndex}setCustomCellSize(e,t,i){("horizontal"===e?this.customColumnWidths:this.customRowHeights).set(t,Math.max(this.minimumCellWidHei,i)),this.updateCellPositions(e)}resizeAllCells(e,t){this.scaleFactor=t/e,this.headerCellsHorizontal.forEach((e=>{this.customColumnWidths.has(e.col-1)||(e.width*=this.scaleFactor)})),this.headerCellsVertical.forEach((e=>{this.customRowHeights.has(e.row-1)||(e.height*=this.scaleFactor)}))}getHeaderCellsHorizontal(e){return this._getVisibleHeaderCells("horizontal",e,this.viewportWidth)}getHeaderCellsVertical(e){return this._getVisibleHeaderCells("vertical",e,this.viewportHeight)}getHeaderCells(){return[this.headerCellsHorizontal,this.headerCellsVertical]}getAllHorizontalHeaderCells(){return this.headerCellsHorizontal}getAllVerticalHeaderCells(){return this.headerCellsVertical}loadMoreContent(e){if("vertical"===e&&this.isInfiniteRow)return this.helper.loadedRows+=this.loadIncrement,this.generateNewCells(),!0;if("horizontal"===e&&this.isInfiniteCol)return this.helper.loadedCols+=this.loadIncrement,this.generateNewCells(),!0;if("vertical"===e){const e=Math.min(this.helper.loadedRows+this.loadIncrement,this.totalRow);if(e>this.helper.loadedRows)return this.helper.loadedRows=e,this.generateNewCells(),!0}else{const e=Math.min(this.helper.loadedCols+this.loadIncrement,this.totalCol);if(e>this.helper.loadedCols)return this.helper.loadedCols=e,this.generateNewCells(),!0}return!1}getScrollbarRatio(e){const t="vertical"===e,i=t?this.totalRow:this.totalCol,s=t?this.helper.loadedRows:this.helper.loadedCols,l=this.calculateVisibleCells()[t?"rows":"cols"],n=t?this.isInfiniteRow:this.isInfiniteCol;t?this.isInfiniteCol:this.isInfiniteRow;return n?Math.min(.4,l/s):Math.min(1,l/i)}_getVisibleHeaderCells(e,t,i){var s;const l="horizontal"===e,n=l?this.headerCellsHorizontal:this.headerCellsVertical,o=this.findStartingIndex(e,t),a=[];let r=(null===(s=n[o])||void 0===s?void 0:s[l?"x":"y"])||0,h=o;for(;r<t+i;){if(h>=n.length){if(!this.loadMoreContent(l?"horizontal":"vertical"))break;continue}const e=n[h];if(!e)break;a.push(e),r+=l?e.width:e.height,h++}return a}findStartingIndex(e,t){const i="horizontal"===e?this.headerCellsHorizontal:this.headerCellsVertical;let s=0,l=i.length-1;for(;s<=l;){const n=Math.floor((s+l)/2),o=i[n];("horizontal"===e?o.x:o.y)+("horizontal"===e?o.width:o.height)>t?l=n-1:s=n+1}return s<i.length?s:i.length}getTotalContainerWidth(){return this.headerCellsHorizontal.slice(0,this.helper.loadedCols).reduce(((e,t)=>e+(this.customColumnWidths.get(t.col-1)||t.width)),0)}getTotalContainerHeight(){return this.headerCellsVertical.slice(0,this.helper.loadedRows).reduce(((e,t)=>e+(this.customRowHeights.get(t.row-1)||t.height)),0)}}class V{constructor(e){this.helper=e,this.scrollX=0,this.scrollY=0,this.maxScrollX=0,this.maxScrollY=0,this.isDragging=!1,this.isScrollbarDragging=!1,this.lastMouseX=0,this.lastMouseY=0,this.loadThreshold=.8,this.helper=e,this.mappingFromHelper(),this.setupEventListeners()}mappingFromHelper(){this.canvases=this.helper.canvases,this.contexts=this.helper.contexts}setupEventListeners(){const e=this.canvases.spreadsheet,{row:t,col:i,index:s}=this.helper.getRowColofExcel();e.addEventListener("wheel",this.handleWheel.bind(this),{passive:!1}),e.addEventListener("mousedown",this.handleMouseDown.bind(this)),document.addEventListener("mousemove",this.handleMouseMove.bind(this)),document.addEventListener("mouseup",this.handleMouseUp.bind(this));const l=document.getElementById(`vertical-bar-${t}-${i}-${s}`),n=document.getElementById(`horizontal-bar-${t}-${i}-${s}`);null==l||l.addEventListener("mousedown",this.handleScrollBarMouseDown.bind(this,"vertical")),null==n||n.addEventListener("mousedown",this.handleScrollBarMouseDown.bind(this,"horizontal"))}setRenderer(e){this.sheetRendrer=e,this.setScrollLimits()}setScrollLimits(){const e=this.canvases.spreadsheet.clientWidth,t=this.canvases.spreadsheet.clientHeight,i=this.helper.getTotalWidth(),s=this.helper.getTotalHeight();this.updateMaxScroll(i,s,e,t)}updateMaxScroll(e,t,i,s){this.maxScrollX=Math.max(0,e-i),this.maxScrollY=Math.max(0,t-s),this.scrollX=Math.min(this.scrollX,this.maxScrollX),this.scrollY=Math.min(this.scrollY,this.maxScrollY),this.updateScrollBar("horizontal"),this.updateScrollBar("vertical")}updateScrollBar(e){var t,i,s,l;const n="vertical"===e?null===(t=this.helper.verticalScroll)||void 0===t?void 0:t.scroll:null===(i=this.helper.horizontalScroll)||void 0===i?void 0:i.scroll,o="vertical"===e?null===(s=this.helper.verticalScroll)||void 0===s?void 0:s.bar:null===(l=this.helper.horizontalScroll)||void 0===l?void 0:l.bar;if(!n||!o||!this.helper)return;const a="vertical"===e?n.clientHeight:n.clientWidth,r=this.helper.getScrollbarRatio(e),h=Math.max(20,a*r),c="vertical"===e?this.maxScrollY:this.maxScrollX,d="vertical"===e?this.scrollY:this.scrollX,u=(a-h)*(c>0?d/c:0);"vertical"===e?(o.style.height=`${h}px`,o.style.top=`${u}px`):(o.style.width=`${h}px`,o.style.left=`${u}px`)}setScroll(e,t){const i=100;e=Math.max(-100,Math.min(e,i)),t=Math.max(-100,Math.min(t,i));let s=Math.max(0,Math.min(this.scrollX+e,this.maxScrollX)),l=Math.max(0,Math.min(this.scrollY+t,this.maxScrollY));s===this.scrollX&&l===this.scrollY||(this.scrollX=s,this.scrollY=l,0!==e&&this.updateScrollBar("horizontal"),0!==t&&this.updateScrollBar("vertical"),this.helper.draw());this.checkAndLoadMoreContent(s,l)&&this.setScrollLimits(),this.helper.updateDrawForFeatures()}handleScrollBarMouseDown(e,t){t.preventDefault(),this.isScrollbarDragging=!0,this.scrollbarDirection=e,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY}handleMouseMove(e){if(this.isDragging){if(e.shiftKey){const t=this.lastMouseX-e.clientX,i=this.lastMouseY-e.clientY;this.setScroll(t,i),this.lastMouseX=e.clientX,this.lastMouseY=e.clientY}}else if(this.isScrollbarDragging&&this.scrollbarDirection){const t=("vertical"===this.scrollbarDirection?e.clientY-this.lastMouseY:e.clientX-this.lastMouseX)/("vertical"===this.scrollbarDirection?this.helper.getScrollRatio("vertical"):this.helper.getScrollRatio("horizontal"));"vertical"===this.scrollbarDirection?this.setScroll(0,t):this.setScroll(t,0),this.lastMouseX=e.clientX,this.lastMouseY=e.clientY}}handleMouseUp(){this.isDragging=!1,this.isScrollbarDragging=!1,this.destroy()}handleWheel(e){if(!e.ctrlKey&&!e.metaKey){e.preventDefault();const t=e.deltaX,i=e.deltaY;this.setScroll(t,i)}}handleMouseDown(e){this.isDragging=!0,this.lastMouseX=e.clientX,this.lastMouseY=e.clientY}checkAndLoadMoreContent(e,t){var i,s,l,n;let o=!1;if(!this.helper)return o;const a=null===(i=this.helper.verticalScroll)||void 0===i?void 0:i.bar,r=(null==a?void 0:a.offsetTop)||0,h=((null===(s=this.helper.verticalScroll)||void 0===s?void 0:s.scroll.clientHeight)||0)-((null==a?void 0:a.clientHeight)||0);h>0&&r/h>=this.loadThreshold&&this.helper.loadMoreContent("vertical")&&(o=!0);const c=null===(l=this.helper.horizontalScroll)||void 0===l?void 0:l.bar,d=(null==c?void 0:c.offsetLeft)||0,u=((null===(n=this.helper.horizontalScroll)||void 0===n?void 0:n.scroll.clientWidth)||0)-((null==c?void 0:c.clientWidth)||0);return u>0&&d/u>=this.loadThreshold&&this.helper.loadMoreContent("horizontal")&&(o=!0),o}constrainScrollPosition(e,t){const i="horizontal"===t?this.maxScrollX:this.maxScrollY;return Math.max(0,Math.min(e,i))}getScroll(){return{x:this.scrollX,y:this.scrollY}}destroy(){const e=this.canvases.spreadsheet;e.removeEventListener("wheel",this.handleWheel),e.removeEventListener("mousedown",this.handleMouseDown),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp)}}class N{constructor(e){this.lastVisibleRow=0,this.lastVisibleCol=0,this.helper=e,this.zoomIndex=this.helper.zoomIndex,this.minZoom=this.helper.minZoom,this.maxZoom=this.helper.maxZoom,this.baseGridSize=20,this.lastDevicePixelRatio=window.devicePixelRatio,this.mappingFromHelper(),this.setUpResizeObserver(),this.setupEventListeners(),this.monitorDevicePixelRatio()}mappingFromHelper(){this.resizeObserver=this.helper.resizeObserver,this.canvases=this.helper.canvases,this.contexts=this.helper.contexts}setUpResizeObserver(){this.resizeObserver=new ResizeObserver(this.handleResize.bind(this)),this.resizeObserver.observe(this.canvases.spreadsheet)}resizeCanvases(){var e;const t=window.devicePixelRatio;Object.values(null!==(e=this.canvases)&&void 0!==e?e:{}).forEach((e=>this.updateCanvasDimensions(null!=e?e:{},t))),this.updateHeaderCells(),this.draw(),this.helper.updateDrawForFeatures()}updateCanvasDimensions(e,t){const i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t;e.getContext("2d").scale(t,t)}setupEventListeners(){window.addEventListener("resize",this.handleResize.bind(this)),this.canvases.spreadsheet.addEventListener("wheel",this.handleWheel.bind(this),{passive:!1})}handleResize(){this.resizeCanvases()}handleWheel(e){if(e.ctrlKey||e.metaKey){e.preventDefault();const t=e.deltaY>0?.9:1.1,i=this.canvases.spreadsheet.getBoundingClientRect(),s=e.clientX-i.left,l=e.clientY-i.top;this.zoom(t,s,l)}}zoom(e,t,i){const s=Math.min(Math.max(this.zoomIndex*e,this.minZoom),this.maxZoom);(0===this.helper.totalCol&&0===this.helper.totalRow||this.lastVisibleRow+5<this.helper.totalRow&&this.lastVisibleCol+5<this.helper.totalCol||s>this.zoomIndex||0===this.helper.totalCol&&this.lastVisibleRow+5<this.helper.totalRow||s>this.zoomIndex||0===this.helper.totalRow&&this.lastVisibleCol+5<this.helper.totalCol||s>this.zoomIndex)&&this.applyzoom(s)}applyzoom(e){this.zoomIndex=e,this.updateHeaderCells(),this.helper.updateMaxScroll(),this.draw(),this.helper.updateDrawForFeatures()}monitorDevicePixelRatio(){const e=()=>{const t=window.devicePixelRatio;t!==this.lastDevicePixelRatio&&(this.lastDevicePixelRatio=t,this.resizeCanvases()),requestAnimationFrame(e)};requestAnimationFrame(e)}clearCanvases(){var e;Object.entries(null!==(e=this.contexts)&&void 0!==e?e:{}).forEach((([e,t])=>{const i=this.canvases[e];t.clearRect(0,0,i.width/window.devicePixelRatio,i.height/window.devicePixelRatio)}))}updateHeaderCells(){const e=this.canvases.spreadsheet.clientWidth,t=this.canvases.spreadsheet.clientHeight;this.helper.updateZoomIndex(e,t,this.zoomIndex),this.helper.updateMaxScroll()}draw(){this.clearCanvases();const{x:e,y:t}=this.helper.getScroll();this.drawHeaders(e,t),this.drawGrid(e,t),this.drawSparseMatrixValues(e,t)}drawHeaders(e,t){this.verticalCells=this.helper.getVerticalHeaderCells(t),this.lastVisibleRow=this.verticalCells[this.verticalCells.length-1].row,this.horizontalCells=this.helper.getHorizontalHeaderCells(e),this.lastVisibleCol=this.horizontalCells[this.horizontalCells.length-1].col,this.drawHeaderCells(this.contexts.vertical,this.verticalCells,!0,t),this.drawHeaderCells(this.contexts.horizontal,this.horizontalCells,!1,e)}drawHeaderCells(e,t,i,s){e.lineWidth=1,e.textAlign=c,e.textBaseline=d,e.strokeStyle=a,e.fillStyle=r;const l=this.canvases[i?"vertical":"horizontal"].width/window.devicePixelRatio,n=this.canvases[i?"vertical":"horizontal"].height/window.devicePixelRatio;t.forEach((t=>{if(i&&t.y-s<n&&t.y+t.height-s>0||!i&&t.x-s<l&&t.x+t.width-s>0)if(e.beginPath(),i){const i=t.y-s;e.moveTo(0,i),e.lineTo(l,i),e.stroke(),this.drawAtCentered(e,t.value.toString(),0,i,l,t.height)}else{const i=t.x-s;e.moveTo(i,0),e.lineTo(i,n),e.stroke(),this.drawAtCentered(e,t.value.toString(),i,0,t.width,n)}}))}drawAtCentered(e,t,i,s,l,n){const o=this.baseGridSize*this.zoomIndex;let a=Math.min(o,.8*n);e.font=`${a}px ${h}`;let r=e.measureText(t).width;r>.9*l&&(a*=.9*l/r,e.font=`${a}px ${h}`,r=e.measureText(t).width);const c=e.measureText(t),d=i+(l-r)/2,u=s+(n+(c.actualBoundingBoxAscent+c.actualBoundingBoxDescent))/2-c.actualBoundingBoxDescent;e.fillText(t,d,u)}drawGrid(e,t){const i=this.contexts.spreadsheet,s=this.verticalCells,l=this.horizontalCells;i.strokeStyle=a,i.lineWidth=1;const n=this.canvases.spreadsheet.width/window.devicePixelRatio,o=this.canvases.spreadsheet.height/window.devicePixelRatio;s.forEach((e=>{const s=e.y-t;i.beginPath(),i.moveTo(0,s),i.lineTo(n,s),i.stroke()})),l.forEach((t=>{const s=t.x-e;i.beginPath(),i.moveTo(s,0),i.lineTo(s,o),i.stroke()}))}drawSparseMatrixValues(e,i){var l,n,o,a,d,u,p,C,x,b,w,f,E;const y=this.contexts.spreadsheet,S=this.canvases.spreadsheet.width/window.devicePixelRatio,M=this.canvases.spreadsheet.height/window.devicePixelRatio,R=new Map(this.verticalCells.map((e=>[e.value,e]))),z=new Map(this.horizontalCells.map((e=>[e.value,e])));let H=this.helper.getRowheader();for(const T in H){let I=H[T];for(;I;){const H=R.get(I.rowValue),T=z.get(this.helper.numberToColumnName(I.colValue));if(!H||!T){I=I.nextCol;continue}const $=T.x-e,L=H.y-i;if(!(!I.mergedTo||I.mergedTo===I)){I=I.nextCol;continue}const{width:B,height:k}=this.helper.getMergedRange(I),A=this.horizontalCells.find((e=>e.col===I.colValue+B-1)),F=this.verticalCells.find((e=>e.row===I.rowValue+k-1));if(!A||!F){I=I.nextCol;continue}const D=A.x+A.width-T.x,V=F.y+F.height-H.y;if($<S&&L<M&&$+D>0&&L+V>0){if(y.save(),I){y.fillStyle=null!==(l=I.styles.color)&&void 0!==l?l:r;const e=(null!==(o=null===(n=I.styles)||void 0===n?void 0:n.fontSize)&&void 0!==o?o:m)*this.zoomIndex,t=null!==(d=null===(a=I.styles)||void 0===a?void 0:a.fontFamily)&&void 0!==d?d:h,i=(null===(u=I.styles)||void 0===u?void 0:u.bold)?"bold":"normal",s=(null===(p=I.styles)||void 0===p?void 0:p.italic)?"italic":"normal";y.font=`${s} ${i} ${e}px ${t}`}if(y.beginPath(),y.fillStyle=null!==(C=I.styles.fill)&&void 0!==C?C:g,y.fillRect($+.5,L+.5,D-1,V-1),y.fillStyle=null!==(x=I.styles.color)&&void 0!==x?x:v,y.rect($,L,D,V),y.clip(),void 0!==I.value&&null!==I.value){let e=$+(null!==(b=I.styles.textIndent)&&void 0!==b?b:0)+D/2,i=L+V/2;y.textAlign=c,I.styles.textAlign===t.Left?(e=$+(null!==(w=I.styles.textIndent)&&void 0!==w?w:0)+8,y.textAlign=t.Left):I.styles.textAlign===t.Center?(e=$+(null!==(f=I.styles.textIndent)&&void 0!==f?f:0)+D/2,y.textAlign=t.Center):I.styles.textAlign===t.Right&&(e=$+(null!==(E=I.styles.textIndent)&&void 0!==E?E:0)+D-8,y.textAlign=t.Right),I.styles.textBaseline===s.Start?(i=L+8,y.textBaseline=s.Top):I.styles.textBaseline===s.Middle?(i=L+V/2,y.textBaseline=s.Middle):I.styles.textBaseline===s.End&&(i=L+V-8,y.textBaseline=s.Bottom),y.fillText(I.value.toString(),e,i)}y.restore()}I=I.nextCol}}}}class _{constructor(e){this.minZoom=.1,this.maxZoom=5,this.loadedRows=0,this.loadedCols=0,this.sheetMaker=e,this.totalRow=100,this.totalCol=60,this.canvases={},this.contexts={},this.zoomIndex=1,this.initCanvases(),this.SparseMatrix=new I,this.GridHeaderManager=new D(this,this.canvases.spreadsheet.clientWidth,this.canvases.spreadsheet.clientHeight,this.zoomIndex,this.totalRow,this.totalCol),this.scroll=new V(this),this.sheetRendrer=new N(this),this.scroll.setRenderer(this.sheetRendrer),this.initiatefeature()}initiatefeature(){this.mainCellManager=new A(this),this.headerCellManager=new L(this)}initCanvases(){Object.values(e).forEach((e=>{const t=document.getElementById(`${e}-canvas-${this.sheetMaker.row}-${this.sheetMaker.col}-${this.sheetMaker.index}`);if(!t)throw new Error(`Canvas not found: ${e}-canvas-${this.sheetMaker.row}-${this.sheetMaker.col}-${this.sheetMaker.index}`);this.canvases[e]=t,this.contexts[e]=t.getContext("2d")})),this.verticalScroll={scroll:document.getElementById(`vertical-scroll-${this.sheetMaker.row}-${this.sheetMaker.col}-${this.sheetMaker.index}`),bar:document.getElementById(`vertical-bar-${this.sheetMaker.row}-${this.sheetMaker.col}-${this.sheetMaker.index}`)},this.horizontalScroll={scroll:document.getElementById(`horizontal-scroll-${this.sheetMaker.row}-${this.sheetMaker.col}-${this.sheetMaker.index}`),bar:document.getElementById(`horizontal-bar-${this.sheetMaker.row}-${this.sheetMaker.col}-${this.sheetMaker.index}`)}}getCanvases(){return this.canvases}getContexts(){return this.contexts}loadMoreContent(e){var t;return null===(t=this.GridHeaderManager)||void 0===t?void 0:t.loadMoreContent(e)}getScrollbarRatio(e){var t;return null===(t=this.GridHeaderManager)||void 0===t?void 0:t.getScrollbarRatio(e)}numberToColumnName(e){let t="";for(;e>0;)e--,t=String.fromCharCode(65+e%26)+t,e=Math.floor(e/26);return t}letterToNumber(e){return e.split("").reduce(((e,t)=>26*e+(t.charCodeAt(0)-"A".charCodeAt(0)+1)),0)}getCell(e,t){return this.SparseMatrix.getCell(e,t)}getCellSize(e,t){var i;return null===(i=this.GridHeaderManager)||void 0===i?void 0:i.getCellSize(e,t)}setCustomCellSize(e,t,i){var s;null===(s=this.GridHeaderManager)||void 0===s||s.setCustomCellSize(e,t,i)}getRowColofExcel(){return{row:this.sheetMaker.row,col:this.sheetMaker.col,index:this.sheetMaker.index}}updateZoomIndex(e,t,i){var s;this.zoomIndex=i,null===(s=this.GridHeaderManager)||void 0===s||s.update(e,t,this.zoomIndex)}updateCells(){var e;null===(e=this.GridHeaderManager)||void 0===e||e.generateNewCells()}updateCellsForSparse(e){this.SparseMatrix.updateCellsForSparse(e)}getRowheader(){return this.SparseMatrix.rowHeaders}setValue(e){e.forEach(((e,t)=>{e.forEach(((e,i)=>{if(null!=e&&""!==e){this.SparseMatrix.addRowInBetween(t),this.SparseMatrix.addColumnInBetween(i);let s=this.SparseMatrix.rowHeaders[t];s||(s=new T(t,i,e),this.SparseMatrix.rowHeaders[t]=s);let l=s;for(;l;){if(l.colValue===i){l.value=e;break}l=l.nextCol}l||(new T(t,i,e),this.SparseMatrix.addColumnInBetween(t),this.SparseMatrix.addRowInBetween(i))}}))}))}updateDrawForFeatures(){this.mainCellManager.updateDrawForScrolling()}getScrollRatio(e){const t="horizontal"===e?`horizontal-scroll-${this.sheetMaker.row}-${this.sheetMaker.col}-${this.sheetMaker.index}`:`vertical-scroll-${this.sheetMaker.row}-${this.sheetMaker.col}-${this.sheetMaker.index}`,i=document.getElementById(t);if(!i)throw new Error(`${e} scroll element not found.`);if(!(i instanceof HTMLElement))throw new Error(`${e} scroll element is not a valid HTMLElement.`);const s="horizontal"===e?this.scroll.maxScrollX:this.scroll.maxScrollY,l="horizontal"===e?i.clientWidth:i.clientHeight;return l/(l+s)}getScroll(){return this.scroll.getScroll()}setScroll(e,t){this.scroll.setScroll(e,t)}updateMaxScroll(){const e=this.GridHeaderManager.getTotalContainerWidth(),t=this.GridHeaderManager.getTotalContainerHeight(),i=this.canvases.spreadsheet.clientWidth,s=this.canvases.spreadsheet.clientHeight;this.scroll.updateMaxScroll(e,t,i,s)}getTotalWidth(){return this.GridHeaderManager.getTotalContainerWidth()}getTotalHeight(){return this.GridHeaderManager.getTotalContainerHeight()}getHorizontalHeaderCells(e){return this.GridHeaderManager.getHeaderCellsHorizontal(e)}getVerticalHeaderCells(e){return this.GridHeaderManager.getHeaderCellsVertical(e)}getAllHorizontalHeaderCells(){return this.GridHeaderManager.getAllHorizontalHeaderCells()}getAllVerticalHeaderCells(){return this.GridHeaderManager.getAllVerticalHeaderCells()}draw(){this.sheetRendrer.draw()}binarySearch(e,t,i){let s=0,l=e.length-1;for(;s<=l;){const n=Math.floor((s+l)/2),o=e[n],a="x"===i?o.x:o.y;if(a<=t&&t<a+("x"===i?o.width:o.height))return n;a>t?l=n-1:s=n+1}return s}setCell(e,t,i){this.SparseMatrix.setCell(e,t,i)}getMergedRange(e){if(!e.mergedTo||e===e.mergedTo){let t=1,i=1,s=e;for(;s.nextCol&&s.nextCol.mergedTo===e;)t++,s=s.nextCol;let l=e;for(;l.nextRow&&l.nextRow.mergedTo===e;)i++,l=l.nextRow;return{width:t,height:i,isMerged:!0}}return{width:1,height:1,isMerged:!1}}}class P{constructor(e,t,i,s){this.sheetName=e,this.row=t,this.col=i,this.index=s,this.sheetSectionElements={topSection:this.createTopSection(),bottomSection:this.createBottomSection()},this.waitForSectionsToRender()}waitForSectionsToRender(){const e=new MutationObserver((t=>{for(const i of t)if(document.body.contains(this.sheetSectionElements.topSection)&&document.body.contains(this.sheetSectionElements.bottomSection)){this.helper=new _(this),e.disconnect();break}}));e.observe(document.body,{childList:!0,subtree:!0})}createTopSection(){const e=document.createElement("div");e.id=`top-section-${this.row}-${this.col}-${this.index}`,e.className="top-section";const t=document.createElement("div");t.id=`nothing-${this.row}-${this.col}-${this.index}`,t.className="nothing";const i=document.createElement("div");i.id=`horizontal-canvas-wrapper-${this.row}-${this.col}-${this.index}`,i.className="horizontal-canvas-wrapper";const s=document.createElement("canvas");return s.id=`horizontal-canvas-${this.row}-${this.col}-${this.index}`,s.className="horizontal-canvas",i.appendChild(s),e.appendChild(t),e.appendChild(i),e}createBottomSection(){const e=document.createElement("div");e.id=`bottom-section-${this.row}-${this.col}-${this.index}`,e.className="bottom-section";const t=document.createElement("div");t.id=`vertical-canvas-wrapper-${this.row}-${this.col}-${this.index}`,t.className="vertical-canvas-wrapper";const i=document.createElement("canvas");i.id=`vertical-canvas-${this.row}-${this.col}-${this.index}`,i.className="vertical-canvas",t.appendChild(i);const s=document.createElement("div");s.id=`spreadsheet-canvas-wrapper-${this.row}-${this.col}-${this.index}`,s.className="spreadsheet-canvas-wrapper";const l=document.createElement("canvas");l.id=`spreadsheet-canvas-${this.row}-${this.col}-${this.index}`,l.className="spreadsheet-canvas";const n=this.createScrollbar("vertical"),o=this.createScrollbar("horizontal"),a=document.createElement("div");return a.setAttribute("contenteditable","true"),a.id=`input_${this.row}_${this.col}_${this.index}`,a.className="input",s.appendChild(a),s.appendChild(l),s.appendChild(n),s.appendChild(o),e.appendChild(t),e.appendChild(s),e}createScrollbar(e){const t=document.createElement("div");t.id=`${e}-scroll-${this.row}-${this.col}-${this.index}`,t.className=`${e}-scroll`;const i=document.createElement("div");return i.id=`${e}-bar-${this.row}-${this.col}-${this.index}`,i.className=`${e}-bar`,t.appendChild(i),t}}class W{constructor(e,t,i,s){this.activeSheetIndex=0,this.sheetsArr=[],this.excelRowContainer=e,this.excelRowNumber=t,this.excelColNumber=i,this.excelsHandler=s,this.init()}init(){this.createExcelElement(),this.createInitialSheet(),this.appendChildrenToExcelElement(),this.updateContentArea(),this.notifyExcelsHandler(),this.handleEvents()}createExcelElement(){this.excelElement=document.createElement("div"),this.excelElement.className="excel resizable",this.excelElement.id=`row-${this.excelRowNumber}-col-${this.excelColNumber}`,this.excelElement.role="gridcell",this.excelElement.ariaRowIndex=`${this.excelRowNumber}`,this.excelElement.ariaColIndex=`${this.excelColNumber}`,this.excelRowContainer.appendChild(this.excelElement)}createInitialSheet(){const e="Sheet1";this.sheetsArr.push({name:e,instance:new P(e,this.excelRowNumber,this.excelColNumber,0)})}appendChildrenToExcelElement(){this.excelElement.innerHTML="",this.contentArea=document.createElement("div"),this.contentArea.className="content-area";const e=this.createSheetBar();this.excelElement.append(this.contentArea,e)}updateContentArea(){this.contentArea.innerHTML="";const e=this.sheetsArr[this.activeSheetIndex].instance;this.contentArea.appendChild(e.sheetSectionElements.topSection),this.contentArea.appendChild(e.sheetSectionElements.bottomSection)}createSheetBar(){const e=document.createElement("div");e.className="sheet-bar";const t=document.createElement("div");t.className="sheet-controls",t.innerHTML='<button class="add-sheet">+</button>';const i=document.createElement("div");i.className="sheet-tabs",this.updateSheetTabs(i);const s=document.createElement("div");s.className="sheet-scroll",s.innerHTML='\n            <button class="scroll-left">◀</button>\n            <button class="scroll-right">▶</button>\n        ',e.append(t,i,s);return t.querySelector(".add-sheet").addEventListener("click",(()=>this.addSheet())),i.addEventListener("click",(e=>this.handleSheetTabClick(e))),e}handleSheetTabClick(e){var t,i;const s=e.target;if(s.classList.contains("sheet-tab")){const e=parseInt(null!==(t=s.dataset.index)&&void 0!==t?t:"0");this.switchSheet(e)}else if(s.classList.contains("close-tab")){const e=parseInt(null!==(i=s.dataset.index)&&void 0!==i?i:"0");this.removeSheet(e)}}updateSheetTabs(e){e.innerHTML=this.sheetsArr.map(((e,t)=>`\n            <div class="sheet-tab ${t===this.activeSheetIndex?"active":""}" data-index="${t}">\n                ${e.name}\n                <button class="close-tab" data-index="${t}">✖</button>\n            </div>\n        `)).join("")}addSheet(){const e=this.sheetsArr.length,t=`Sheet${e+1}`;this.sheetsArr.push({name:t,instance:new P(t,this.excelRowNumber,this.excelColNumber,e)}),this.switchSheet(e),this.updateSheetTabs(this.excelElement.querySelector(".sheet-tabs"))}switchSheet(e){e!==this.activeSheetIndex&&e>=0&&e<this.sheetsArr.length&&(this.activeSheetIndex=e,this.updateContentArea(),this.updateSheetTabs(this.excelElement.querySelector(".sheet-tabs")))}removeSheet(e){this.sheetsArr.length<=1?alert("You cannot remove the last sheet."):(this.sheetsArr.splice(e,1),e===this.activeSheetIndex?this.activeSheetIndex=Math.max(0,e-1):e<this.activeSheetIndex&&this.activeSheetIndex--,this.updateContentArea(),this.updateSheetTabs(this.excelElement.querySelector(".sheet-tabs")))}handleEvents(){this.excelElement.addEventListener("click",(e=>{this.handleMouseDown(e)}))}handleMouseDown(e){e.preventDefault(),this.notifyExcelsHandler()}notifyExcelsHandler(){this.excelsHandler.updateCurrExcel(this.excelRowNumber,this.excelColNumber,this.sheetsArr[this.activeSheetIndex])}}var X;!function(e){e.NORMAL="normal",e.BLUE="blue",e.GREEN="green",e.VIOLET="violet"}(X||(X={}));class Y{constructor(e=X.VIOLET){this.predefinedThemes={},this.predefinedThemesJson={green:{themeColor:"#1b8731",themeColorL1:"#32ae4c",themeColorL2:"#52ca69",themeColorL3:"#87e090",themeColorL4:"#d0eed4",themeColorL5:"#e1f8e4",themeColorD1:"#16772a",themeColorD2:"#155a23",themeColorD3:"#183a1f",themeColorD4:"#0a1e12",themeColorD5:"#060f0a"},blue:{themeColor:"#0176d5",themeColorL1:"#2b9ef9",themeColorL2:"#65b9ff",themeColorL3:"#9dd2fe",themeColorL4:"#d3eafc",themeColorL5:"#e7f4fc",themeColorD1:"#0e65c2",themeColorD2:"#094a9e",themeColorD3:"#0e306d",themeColorD4:"#061939",themeColorD5:"#040d1e"},violet:{themeColor:"#9a41ff",themeColorL1:"#b67ef9",themeColorL2:"#cca1fa",themeColorL3:"#ddc1fc",themeColorL4:"#ece2fa",themeColorL5:"#f4f0fe",themeColorD1:"#871eff",themeColorD2:"#6405d1",themeColorD3:"#430290",themeColorD4:"#25034d",themeColorD5:"#140522"}},this.init(e)}init(e){this.predefinedThemes=this.getPredefinedThemes(),this.updateTheme(e)}getPredefinedThemes(){return this.predefinedThemesJson}updateTheme(e){"string"==typeof e&&this.predefinedThemes[e]?this.activeTheme=this.predefinedThemes[e]:"object"==typeof e&&(this.activeTheme=e),this.setTheme(this.activeTheme)}setTheme(e){Object.entries(e).forEach((([e,t])=>{t&&document.documentElement.style.setProperty(`--${e}`,t)}))}}class O{constructor(e,t,i){this.selectedExcel=null,this.totalExcelRows=0,this.excelsRowArr=[],this.mainContainer=e,this.maxExcelRow=t,this.maxExcelCol=i,this.init()}init(){this.setupTheme(),this.addNewExcelRow(),this.handleResize(),this.setupEventListeners()}setupTheme(){this.themeManager=new Y,this.themeManager.updateTheme("violet")}setupEventListeners(){this.mainContainer.addEventListener("click",(e=>this.handleClick(e)));const e=document.querySelector(".add-new-row"),t=document.querySelector(".add-new-col"),i=document.querySelector(".delete-excel");null==e||e.addEventListener("click",(()=>this.addNewExcelRow())),null==t||t.addEventListener("click",(()=>{void 0!==this.currExcelRow&&this.addNewExcelCol(this.currExcelRow)})),null==i||i.addEventListener("click",(()=>{void 0!==this.currExcelRow&&void 0!==this.currExcelCol&&this.deleteExcel(this.currExcelRow,this.currExcelCol)}))}handleClick(e){this.selectedExcel&&(this.selectedExcel.style.border="1px solid black");const t=e.target.closest("div[aria-rowindex][aria-colindex]");t&&(t.style.border="1px solid red",this.selectedExcel=t)}updateCurrExcel(e,t,i){this.currExcelRow=e,this.currExcelCol=t,this.currSheetObj=i}addNewExcelRow(){if(this.totalExcelRows>=this.maxExcelRow)return void alert("No more rows can be added");this.totalExcelRows++;const e=document.createElement("div");e.className="row",e.id=`row-${this.totalExcelRows}`;const t=new W(e,this.totalExcelRows,1,this);this.excelsRowArr[this.totalExcelRows-1]=[t],this.mainContainer.appendChild(e),this.addResizeHandles(),this.handleResize()}addNewExcelCol(e){if(e>this.totalExcelRows)return;let t=this.excelsRowArr[e-1].length;if(t>=this.maxExcelCol)return void alert("No more columns can be added");t+=1;const i=document.getElementById(`row-${e}`);if(!i)return;const s=new W(i,e,t,this);this.excelsRowArr[e-1].push(s),this.addResizeHandles(),this.handleResize()}deleteExcel(e,t){const i=document.getElementById(`row-${e}`);if(i){const e=i.querySelectorAll(".excel");e[t-1]&&i.removeChild(e[t-1])}this.excelsRowArr[e-1].splice(t-1,1),0!==this.excelsRowArr[e-1].length?(this.excelsRowArr.forEach(((e,i)=>{e.forEach(((e,i)=>{const s=i+1;s>=t&&(e.excelElement.style.gridColumn=String(s),e.excelElement.dataset.col=String(s))}))})),this.addResizeHandles()):this.deleteRow(e)}deleteRow(e){const t=document.getElementById(`row-${e}`);t&&this.mainContainer.removeChild(t),this.excelsRowArr.splice(e-1,1);for(let t=e;t<=this.totalExcelRows;t++){const e=document.getElementById(`row-${t}`);if(e){e.id="row-"+(t-1);e.querySelectorAll(".excel").forEach((e=>{e.dataset.row=String(t-1)}))}}this.totalExcelRows--,this.addResizeHandles()}addResizeHandles(){this.excelsRowArr.forEach(((e,t)=>{const i=document.getElementById(`row-${t+1}`);if(i&&t<this.excelsRowArr.length-1){const e=document.createElement("div");e.className="row-resize-handle",i.appendChild(e)}e.forEach(((i,s)=>{if(s<e.length-1){const e=document.getElementById(`row-${t+1}-col-${s+1}`),i=document.createElement("div");i.className="col-resize-handle",null==e||e.appendChild(i)}}))}))}handleResize(){let e=!1,t=null,i=0,s=0,l=0,n=0,o="";const a=a=>{if(e&&t){if("column"===o){const e=l+(a.clientX-i);t.style.width=`${e}px`,t.style.flex="none"}else if("row"===o){const e=n+(a.clientY-s),i=Math.max(e,50);t.style.height=`${i}px`,t.style.flex="none"}t.style.display="none",t.offsetHeight,t.style.display=""}},r=()=>{e=!1,t=null,document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",r)};this.mainContainer.addEventListener("mousedown",(h=>{const c=h.target;if(c.classList.contains("col-resize-handle"))t=c.closest(".excel"),o="column";else{if(!c.classList.contains("row-resize-handle"))return;t=c.closest(".row"),o="row"}e=!0,i=h.clientX,s=h.clientY,l=t.offsetWidth,n=t.offsetHeight,document.addEventListener("mousemove",a),document.addEventListener("mouseup",r),h.preventDefault()}))}}class G{constructor(e){this.rumblesheetElement=e,this.initializeElements(),this.updateRibbonScrollBtnsVisible()}initializeElements(){this.tabButtons=document.querySelectorAll(".tablist-items"),this.tabContents=document.querySelectorAll(".focus-tab"),this.toggleContentBtn=document.getElementById("toggle-content"),this.focusZone=document.querySelector(".focus-zone"),this.featureMenuBtns=document.querySelectorAll(".feature-menu"),this.ribbon=document.getElementById("ribbon"),this.scrollLeftBtn=document.querySelector(".scroll-left"),this.scrollRightBtn=document.querySelector(".scroll-right"),this.focusContent=document.querySelector(".focus-content")}toggleTabForTarget(e){const t=Array.from(this.tabButtons).indexOf(e);this.tabButtons.forEach((e=>{e.classList.remove("active"),e.classList.remove("left-to-active"),e.classList.remove("right-to-active")})),this.tabContents.forEach((e=>e.classList.remove("active"))),this.tabButtons[t].classList.add("active"),this.tabContents[t].classList.add("active"),this.tabButtons[t-1]&&this.tabButtons[t-1].classList.add("left-to-active"),this.tabButtons[t+1]&&this.tabButtons[t+1].classList.add("right-to-active")}toggleContentBtnFunc(){this.focusZone&&this.focusZone.classList.toggle("expanded"),this.updateRibbonScrollBtnsVisible()}handleFeatureMenuToggle(e){const t=e.target,i=t.closest(".tab-section").querySelector(".feature-box");if(!this.ribbon||!this.focusZone||!this.rumblesheetElement)return;const s=this.ribbon.getBoundingClientRect(),l=e.clientX-s.left+5-this.focusZone.offsetLeft,n=e.clientY-s.top+5-this.focusZone.offsetTop;i.classList.toggle("opened");let o=l,a=n;if(i.offsetWidth+l>=this.rumblesheetElement.clientWidth&&(o=l-(i.offsetWidth+l-this.rumblesheetElement.clientWidth)-25),i.offsetHeight+n>=this.rumblesheetElement.clientHeight&&(a=n-(i.offsetHeight+n-this.rumblesheetElement.clientHeight)-25),i.style.left=`${o}px`,i.style.top=`${a}px`,i.classList.contains("opened")){const e=s=>{i.contains(s.target)||s.target===t||(i.classList.remove("opened"),document.removeEventListener("click",e))};document.addEventListener("click",e)}}handleScrollRibbon(e){const t=document.querySelector(".focus-tab.active");e.target instanceof HTMLElement&&(e.target.closest(".scroll-left")?t.scrollLeft-=150:e.target.closest(".scroll-right")&&(t.scrollLeft+=150))}isOverflowingHorizontally(e){return e.scrollWidth>e.clientWidth}updateRibbonScrollBtnsVisible(){if(!this.focusContent||!this.scrollLeftBtn||!this.scrollRightBtn)return;const e=document.querySelector(".focus-tab.active");this.isOverflowingHorizontally(e)?e.classList.contains("scroll-available")||(this.focusContent.classList.add("scroll-available"),this.scrollLeftBtn.classList.add("scroll-available"),this.scrollRightBtn.classList.add("scroll-available")):(this.focusContent.classList.remove("scroll-available"),this.scrollLeftBtn.classList.remove("scroll-available"),this.scrollRightBtn.classList.remove("scroll-available"))}}class q{constructor(e,t){if(this.tabs=f,this.fontSizes=b,this.fontFamilies=w,this.activeTabIndex=1,!e)throw new Error(`Element with ID ${e} not found.`);this.ribbonElement=e,this.rumblesheetElement=t,this.initRibbon()}initRibbon(){this.createRibbon(),this.ribbonFunctions=new G(this.rumblesheetElement)}getTabList(){return`\n      <div class="tablist-container leftSection" role="tablist" aria-label="Main Tabs">\n        ${this.tabs.map(((e,t)=>`\n            <div\n              role="tab"\n              class="tablist-items${t===this.activeTabIndex?" active":""}"\n              aria-selected="${t===this.activeTabIndex?"true":"false"}"\n              tabindex="${t===this.activeTabIndex?"0":"-1"}"\n              id="tab-${t}"\n              aria-controls="tabpanel-${t}"\n            >\n              ${e}\n            </div>\n          `)).join("")}\n      </div>\n      <div class="rightSection">\n            <p class="name">Rumblesheet</p>\n            <div class="search">Search</div>\n      </div>\n    `}getFileTabContent(){return'\n    <div class="focus-file">\n        <input class="focus-zone-input-btn focus-zone-inner-btn-left" type="file" name="file" accept=".csv" id="fileInput">\n        <button class="focus-zone-inner-btn focus-zone-inner-btn-right" type="submit" value="Upload" id="uploadButton">\n            <span class="iconify" data-icon="material-symbols:upload" data-width="23" data-height="23"></span>\n        </button>\n    </div>\n'}getHomeTabContent(){return`<div class="tab-section section-1">\n                <div class="feature-menu menu-1">\n                  <div class="icon icon-paste-20"></div>\n                  <div class="name">Clipboard</div>\n                  <div class="feature-menu-arrow icon-down"></div>\n                </div>\n                <div class="feature-box box-1">\n                  <div class="content divided-in-column">\n                    <div class="col">\n                      <div class="feature-vertical btn" role="button" tabindex="0" data-action = '${n.Paste}' >\n                        <div class="icon icon-paste"></div>\n                        <p class="icon-name">Paste</p>\n                      </div>\n                    </div>\n                    <div class="sub-divider collapsed"></div>\n                    <div class="col">\n                      <div class="feature-horizontal btn" role="button" tabindex="0"  data-action = '${n.Cut}' >\n                        <div class="icon icon-cut"></div>\n                        <p class="icon-name">Cut</p>\n                      </div>\n                      <div class="feature-horizontal btn" role="button" tabindex="0"  data-action = '${n.Copy}' >\n                        <div class="icon icon-copy"></div>\n                        <p class="icon-name">Copy</p>\n                      </div>\n                    </div>\n                  </div>\n                  <div class="name">Clipboard</div>\n                </div>\n              </div>\n              <div class="divider"></div>\n              <div class="tab-section section-2">\n                <div class="feature-menu menu-2" >\n                  <div class="icon icon-bold"></div>\n                  <div class="name">Font</div>\n                  <div class="feature-menu-arrow icon-down"></div>\n                </div>\n                <div class="feature-box box-2">\n                  <div class="content divided-in-row">\n                    <div class="row">\n                      <select\n                        class="select-options"\n                        data-action = '${n.FontFamily}'\n                        name="font-family"\n                        id="family-select"\n                      >\n                        ${this.fontFamilies.map((e=>`<option value="${e}" ${e===p?"selected":""}\n                              style = "font-family : ${e}"\n                                  >${e}</option>`)).join("")}\n                      </select>\n                      <select\n                        class="select-options"\n                        data-action = '${n.FontSize}'\n                        name="font-size"\n                        id="size-select"\n                      >\n                        ${this.fontSizes.map((e=>`<option value="${e}" ${e===m?"selected":""}>${e}</option>`)).join("")}\n                      </select>\n                      <div class="feature-icon" role="button" tabindex="0"  data-action = '${n.DecreaseFont}'>\n                        <div class="icon icon-font-size-decrease"></div>\n                        <p class="icon-name">Font Size Decrease</p>\n                      </div>\n                      <div class="feature-icon" role="button" tabindex="0"  data-action = '${n.IncreaseFont}' >\n                        <div class="icon icon-font-size-increase"></div>\n                        <p class="icon-name">Font Size Increase</p>\n                      </div>\n                    </div>\n                    <div class="sub-divider collapsed"></div>\n                    <div class="row">\n                      <div class="feature-icon" role="button" tabindex="0"  data-action = '${n.Bold}' >\n                        <div class="icon icon-bold"></div>\n                        <p class="icon-name">Bold</p>\n                      </div>\n                      <div class="feature-icon" role="button" tabindex="0"  data-action = '${n.Italic}' >\n                        <div class="icon icon-italic"></div>\n                        <p class="icon-name">Italic</p>\n                      </div>\n                      <div class="feature-icon" role="button" tabindex="0"  data-action = '${n.Underline}' >\n                        <div class="icon icon-underline"></div>\n                        <p class="icon-name">Underline</p>\n                      </div>\n                      <div class="feature-icon feature-icon-input">\n                        <div class="icon icon-fill"></div>\n                        <input type="color" data-action = '${n.FillColor}' />\n                        <p class="icon-name">Fill</p>\n                      </div>\n                      <div class="feature-icon feature-icon-input">\n                        <div class="icon icon-A"></div>\n                        <input type="color"  data-action = '${n.TextColor}' />\n                        <p class="icon-name">Font Color</p>\n                      </div>\n                    </div>\n                  </div>\n                  <div class="name">Font</div>\n                </div>\n              </div>\n              <div class="divider"></div>\n              <div class="tab-section section-3">\n                <div class="feature-menu menu-3">\n                  <div class="icon icon-align-center"></div>\n                  <div class="name">Alignment</div>\n                  <div class="feature-menu-arrow icon-down"></div>\n                </div>\n                <div class="feature-box box-3">\n                  <div class="content divided-in-row">\n                    <div class="row">\n                      <div class="feature-icon" role="button" tabindex="0"  data-action = '${n.AlignLeft}' >\n                        <div class="icon icon-align-left"></div>\n                        <p class="icon-name">Align Left</p>\n                      </div>\n                      <div class="feature-icon" role="button" tabindex="0"  data-action = '${n.AlignCenter}'>\n                        <div class="icon icon-align-center"></div>\n                        <p class="icon-name">Align Center</p>\n                      </div>\n                      <div class="feature-icon" role="button" tabindex="0"  data-action = '${n.AlignRight}' >\n                        <div class="icon icon-align-right"></div>\n                        <p class="icon-name">Align Right</p>\n                      </div>\n                    </div>\n                    <div class="sub-divider collapsed"></div>\n                    <div class="row">\n                      <div class="feature-icon" role="button" tabindex="0"  data-action = '${n.DecreaseIndent}' >\n                        <div class="icon icon-decrease-indent"></div>\n                        <p class="icon-name">Decrease Indent</p>\n                      </div>\n                      <div class="feature-icon" role="button" tabindex="0"  data-action = '${n.IncreaseIndent}' >\n                        <div class="icon icon-increase-indent"></div>\n                        <p class="icon-name">Increase Indent</p>\n                      </div>\n                      <div class="row">\n                      <div class="feature-icon" role="button" tabindex="0"  data-action = '${n.TextBaselineTop}' >\n                        <div class="icon icon-text-baseline-top"></div>\n                        <p class="icon-name">Align Top</p>\n                      </div>\n                      <div class="feature-icon" role="button" tabindex="0"  data-action = '${n.TextBaselineMiddle}'>\n                        <div class="icon icon-text-baseline-middle"></div>\n                        <p class="icon-name">Align Middle</p>\n                      </div>\n                      <div class="feature-icon" role="button" tabindex="0"  data-action = '${n.TextBaselineBottom}' >\n                        <div class="icon icon-text-baseline-bottom"></div>\n                        <p class="icon-name">Align Bottom</p>\n                      </div>\n                    </div>\n                    </div>\n                  </div>\n                  <div class="name">Alignment</div>\n                </div>\n              </div>\n              <div class="divider"></div>\n              <div class="tab-section section-4">\n                <div class="feature-menu menu-4">\n                  <div class="icon icon-align-center"></div>\n                  <div class="name">Excel Handles</div>\n                  <div class="feature-menu-arrow icon-down"></div>\n                </div>\n                <div class="feature-box box-4">\n                  <div class="content divided-in-row">\n                    <div class="row">\n                      <div class="feature-icon excel-handle-button" role="button" tabindex="0"  data-action = '${n.AddExcelRow}' >\n                        <div class="icon icon-add-excel-row"></div>\n                        <p class="icon-name">Add Excel Row</p>\n                      </div>\n                      <div class="feature-icon excel-handle-button" role="button" tabindex="0"  data-action = '${n.AddExcelCol}' >\n                        <div class="icon icon-add-excel-column"></div>\n                        <p class="icon-name">Add Excel Column</p>\n                      </div>\n                    </div>\n                    <div class="sub-divider collapsed"></div>\n                    <div class="row">\n                      <div class="feature-icon excel-handle-button" role="button" tabindex="0"  data-action = '${n.DeleteExcel}' >\n                        <div class="icon icon-delete-excel"></div>\n                        <p class="icon-name">Delete Excel</p>\n                      </div>\n                    </div>\n                  </div>\n                  <div class="name">Excel Handles</div>\n                </div>\n              </div>\n              `}getGraphTabContent(){return'\n            <div class="focus-graph">\n                <button class="focus-zone-inner-btn focus-zone-inner-btn-left" data-chart-type="bar">\n                    <span class="iconify" data-icon="mdi:chart-bar" data-width="24" data-height="23"></span>\n                </button>\n                <button class="focus-zone-inner-btn focus-zone-inner-btn-right" data-chart-type="line">\n                    <span class="iconify" data-icon="mdi:chart-line" data-width="23" data-height="23"></span>\n                </button>\n            </div>\n        '}getOperationsTabContent(){return'\n            <div class="focus-operations">\n                <input class="focus-zone-input-btn focus-zone-inner-btn-left" type="text" id="search-input" placeholder="Search...">\n                <button id="search" class="focus-zone-inner-btn focus-zone-inner-btn-right">\n                    <span class="iconify" data-icon="material-symbols:search" data-width="23" data-height="23"></span>\n                </button>\n            </div>\n        '}getFormatTabContent(){return"Format Tab"}getFocusContents(){return`\n      <div class="focus-content">\n        ${this.tabs.map(((e,t)=>{const i=t===this.activeTabIndex?"active":"",s=`tab-${t+1}`;let l="";switch(e){case o.File:l=this.getFileTabContent();break;case o.Home:l=this.getHomeTabContent();break;case o.Graph:l=this.getGraphTabContent();break;case o.Operations:l=this.getOperationsTabContent();break;case o.Format:l=this.getFormatTabContent();break;default:l=`<div> No content available for ${e} </div>`}return`\n              <div class="focus-tab ${s} ${i}" id="${s}">\n                ${l}\n              </div>\n            `})).join("")}\n      </div>\n    `}getFocusSection(){return`<div class="scroll-left btn" role="button" tabindex="0">\n            <div class="icon icon-down"></div>\n          </div> ${this.getFocusContents()} <div class="scroll-right btn" role="button" tabindex="0">\n            <div class="icon icon-down"></div>\n          </div> <div class="fixed-to-right">\n            <button class="toggle-content-btn" id="toggle-content">\n              <div class="icon icon-down"></div>\n            </button>\n          </div>`}getBottomSection(){return'\n          <div class="active-cell">\n            <input type="text" value="A1" />\n          </div>\n          <div class="formula-bar">\n            <div class="icon function-icon icon-fx"></div>\n            <textarea rows="1"></textarea>\n          </div>\n       '}createRibbon(){const e=document.createElement("div");e.className="top",e.innerHTML=this.getTabList();const t=document.createElement("div");t.className="focus-zone",t.innerHTML=this.getFocusSection();const i=document.createElement("div");i.className="bottom",i.innerHTML=this.getBottomSection(),this.ribbonElement.appendChild(e),this.ribbonElement.appendChild(t),this.ribbonElement.appendChild(i)}setTabActive(e){e<this.tabs.length&&(this.activeTabIndex=e)}}return class{constructor(e){this.wrapperContainer=e,this.init()}init(){const e=this.createRumblesheetContainer(),t=this.createRibbonContainer(e),i=this.createMainContainer(e);this.wrapperContainer.appendChild(e),this.initializeInstances(t,i)}createRumblesheetContainer(){const e=document.createElement("div");return e.id="rumblesheet",e.className="rumblesheet",e}createRibbonContainer(e){const t=document.createElement("div");return t.id="ribbon",t.className="ribbon",e.appendChild(t),t}createMainContainer(e){const t=document.createElement("div");return t.id="main-container",t.className="main-container",e.appendChild(t),t}initializeInstances(e,t){this.ribbon=new q(e,e.parentElement),this.excelHandler=new O(t,3,3),this.eventManager=new H(this.excelHandler,this.ribbon)}}}));
